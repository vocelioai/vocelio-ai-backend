# Railway Nixpacks Configuration for Vocelio AI Backend
# Fix pip module availability

[phases.setup]
nixpkgs = ['python311', 'python311Packages.pip', 'python311Packages.setuptools', 'gcc', 'libffi', 'openssl', 'postgresql']

[phases.install]
cmds = [
    'echo "=== Python version ==="',
    'python3.11 --version',
    'echo "=== Ensuring pip module is available ==="',
    'python3.11 -m ensurepip --upgrade',
    'echo "=== Verifying pip works ==="',
    'python3.11 -m pip --version',
    'echo "=== Installing FastAPI ==="',
    'python3.11 -m pip install fastapi==0.104.1 uvicorn==0.24.0 pydantic==2.5.0 --no-cache-dir'
]

[phases.build]
cmds = [
    'echo "=== Verifying FastAPI installation ==="',
    'python3.11 -c "import fastapi; print(f\"FastAPI {fastapi.__version__} installed\")"'
]

[start]
cmd = 'python3.11 launcher.py || (cd apps/api-gateway && python3.11 -m uvicorn src.main:app --host 0.0.0.0 --port $PORT)'

[variables]
PYTHONPATH = '/app'
PYTHON_VERSION = '3.11'
PYTHONUNBUFFERED = '1'
